# メモリレポートシステム

## レポートとは何か？

LSMCPメモリシステムにおける**レポート**は、特定の時点（コミット）でのプロジェクトの状態を包括的に記録したスナップショットです。これは、コードベースの進化を理解し追跡するための一時的な調査記録として機能します。

## 主要な特徴

### 1. **一時的な調査結果の記録**
- 特定のgitコミット時点でのプロジェクト状態をキャプチャ
- 機械的なメトリクスとAI生成の洞察の両方を保存
- 後で参照するための履歴コンテキストを保持

### 2. **リポジトリにはコミットしない**
- `.lsmcp/cache/memory.db`（SQLiteデータベース）に保存
- リポジトリの肥大化を防ぐため`.gitignore`に記載
- 各開発者の環境にローカル
- 必要に応じてエクスポート/インポート機能で共有可能

### 3. **目的：後で見返すため**
- プロジェクトの時系列での進化を追跡
- 異なるブランチ/コミット間の状態を比較
- コード品質とアーキテクチャのトレンドを特定
- 履歴データによる意思決定の支援
- コードレビューとリファクタリング計画の促進

## レポートの構成要素

### 機械的オーバービュー（自動生成）
- **ファイル統計**：総ファイル数、言語分布
- **シンボル分析**：クラス、インターフェース、関数、変数
- **依存関係**：ランタイムおよび開発依存関係
- **ディレクトリ構造**：プロジェクトの構成
- **言語メトリクス**：言語ごとのコード行数

### AI分析（オプション）
- **アーキテクチャ評価**：現在のアーキテクチャパターン
- **コード品質メトリクス**：保守性、一貫性スコア
- **主要コンポーネント**：重要なモジュールとその関係
- **改善提案**：実行可能な推奨事項
- **技術的負債**：注意が必要な領域の特定

### メタデータ
- **タイトル**：説明的な名前（自動生成またはカスタム）
- **サマリー**：レポートの簡潔な説明
- **ブランチ**：Gitブランチ名
- **コミットハッシュ**：正確なコミット参照（一意性を保証）
- **タイムスタンプ**：レポート生成時刻

## ユースケース

### 1. **プロジェクト健全性の監視**
```bash
# 週次でプロジェクトの健全性を追跡するレポートを生成
lsmcp generate_report --title "週次健全性チェック" --include-ai
```

### 2. **リリース前のドキュメント化**
```bash
# メジャーリリース前に詳細なレポートを作成
lsmcp generate_report --title "v2.0 リリース状態" --include-ai --prompt "破壊的変更と移行パスに焦点を当てる"
```

### 3. **コードレビューの準備**
```bash
# PRレビュー用のレポート生成
lsmcp generate_report --title "機能X実装" --summary "新しい認証システムの分析"
```

### 4. **技術的負債の追跡**
```bash
# 定期的な負債評価
lsmcp generate_report --include-ai --prompt "技術的負債とリファクタリング機会を特定"
```

### 5. **アーキテクチャの進化**
```bash
# 時間経過によるアーキテクチャの変化を追跡
lsmcp get_report_history --limit 10
lsmcp search_reports_by_keyword "architecture"
```

## なぜレポートをコミットしないのか？

### 1. **リポジトリの清潔性**
- レポートは大きくなる可能性がある（特にAI分析を含む場合）
- 頻繁なレポートはリポジトリ履歴を肥大化させる
- バイナリデータベース形式はバージョン管理に適さない

### 2. **個人的な調査ツール**
- 各開発者が異なる分析視点を望む可能性
- 特定の懸念事項に対するカスタムAIプロンプト
- チームに影響を与えないローカル実験

### 3. **一時的な性質**
- レポートはスナップショットであり、真実の源ではない
- コードが権威であり、レポートは観察結果
- 任意のコミットから再生成可能

### 4. **プライバシーとセキュリティ**
- AI分析が機密パターンを明らかにする可能性
- 公開リポジトリ向けではない内部メトリクス
- 開発者固有の洞察とメモ

## ベストプラクティス

### 1. **定期的な生成**
- 重要なマイルストーンでレポートを作成
- 大規模リファクタリングの前後
- 週次/月次の健全性チェック

### 2. **意味のあるタイトルとサマリー**
```typescript
// 良い例
title: "OAuth統合後の分析"
summary: "OAuth 2.0フロー実装後のセキュリティ監査"

// あまり良くない例
title: "レポート1"
summary: "プロジェクトレポート"
```

### 3. **AI分析の活用**
- ターゲットを絞った洞察のために具体的なプロンプトを使用
- 時間経過でのAI評価を比較
- チームでAI提案を検証

### 4. **レポートライフサイクル管理**
```bash
# 古いレポートを削除（過去30日分を保持）
lsmcp prune_reports --days 30

# 削除前に重要なレポートをエクスポート
lsmcp export_report --id <report-id> --format json
```

### 5. **検索と発見**
```bash
# キーワードでレポートを検索
lsmcp search_reports_by_keyword "performance"

# 日付範囲でレポートを取得
lsmcp search_reports_by_date --start "2024-01-01" --end "2024-01-31"

# ブランチでフィルター
lsmcp get_all_reports --branch "main" --limit 20
```

## 設定

`.lsmcp/config.json`で高度なメモリ機能を有効化：

```json
{
  "memoryAdvanced": true,
  "reportRetentionDays": 90,
  "autoGenerateOnMerge": false,
  "defaultIncludeAI": false
}
```

## データベースの場所

レポートは以下に保存されます：
```
<project-root>/
  .lsmcp/
    cache/
      memory.db    # SQLiteデータベース（コミットされない）
```

`.gitignore`に追加：
```gitignore
.lsmcp/cache/
```

## レポート vs. その他のドキュメント

| 側面 | レポート | README | コードコメント | Gitコミット |
|------|----------|--------|----------------|-------------|
| 目的 | 調査と分析 | ユーザーガイド | コード説明 | 変更履歴 |
| 対象者 | 開発者（自分/チーム） | ユーザー/貢献者 | 開発者 | 全員 |
| 永続性 | ローカル/一時的 | コミット済み | コミット済み | コミット済み |
| 形式 | 構造化データ | Markdown | インラインテキスト | テキストメッセージ |
| 生成 | オンデマンド | 手動 | 手動 | 変更ごと |
| 内容 | メトリクスと洞察 | 手順 | 実装 | 何が変更されたか |

## まとめ

レポートは、リポジトリを散らかすことなくプロジェクトの状態に関する深い洞察を提供する**一時的な調査成果物**です。コードの進化を理解し、情報に基づいた意思決定を行い、時間の経過とともにプロジェクトの健全性を維持するための強力なツールとして機能します。

レポートをプロジェクトの「医療記録」と考えてください - 問題を診断し、健全性を追跡し、改善を計画するのに役立つ詳細なスナップショットですが、実際の「患者」（コードベース）とは別に保管されます。