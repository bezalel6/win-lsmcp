# Debug Adapter Protocol (DAP) 概要

## 概要

Debug Adapter Protocol (DAP) は、開発ツール（IDE/エディタ）とデバッガー間の通信を標準化するプロトコルです。Microsoft によって開発され、VSCode のデバッガー機能の基盤となっています。

## 公式リソース

- **仕様書**: https://microsoft.github.io/debug-adapter-protocol/
- **GitHub**: https://github.com/microsoft/debug-adapter-protocol
- **現行バージョン**: 1.70.0

## アーキテクチャ

```
┌─────────────┐                ┌──────────────┐
│   開発環境   │     DAP        │Debug Adapter │
│  (Client)   │ ←──────────→   │   (Server)   │
└─────────────┘  JSON-RPC      └──────────────┘
                 over stdio
```

### 主要コンポーネント

1. **クライアント（開発環境）**
   - VSCode、Visual Studio、その他のIDE
   - ユーザーインターフェースを提供
   - DAPリクエストを送信

2. **Debug Adapter（デバッグアダプター）**
   - 言語/ランタイム固有のデバッガーへのブリッジ
   - DAPプロトコルを実装
   - 実際のデバッグ操作を実行

3. **通信チャネル**
   - 標準入出力（stdin/stdout）を使用
   - JSON-RPC風のメッセージフォーマット
   - 非同期・双方向通信

## プロトコルの特徴

### 言語非依存
- 任意のプログラミング言語に対応可能
- 統一されたデバッグインターフェース

### 拡張可能
- カスタムリクエスト/イベントのサポート
- 言語固有の機能を追加可能

### 非同期通信
- リクエスト/レスポンスモデル
- イベントドリブンな通知

## 主要概念

### スレッド（Threads）
- プログラムの実行単位
- 個別に一時停止・再開可能

### ブレークポイント（Breakpoints）
- ソースコード行ブレークポイント
- 関数ブレークポイント
- 条件付きブレークポイント
- データブレークポイント

### スタックフレーム（Stack Frames）
- 実行時のコールスタック
- 各フレームで変数検査が可能

### スコープ（Scopes）
- 変数の可視性範囲
- ローカル、グローバル、クロージャなど

### 変数（Variables）
- 実行時の値を検査
- 構造化データのサポート
- 遅延読み込み対応

## デバッグセッションのライフサイクル

1. **初期化フェーズ**
   - `initialize` リクエストで機能ネゴシエーション
   - `initialized` イベントで準備完了を通知

2. **設定フェーズ**
   - ブレークポイントの設定
   - 例外設定の構成
   - `configurationDone` で設定完了

3. **実行フェーズ**
   - `launch` または `attach` でプログラム開始
   - 実行制御（continue、step、pause）
   - ブレークポイントヒット時の停止

4. **検査フェーズ**
   - スタックトレースの取得
   - 変数値の検査
   - 式の評価

5. **終了フェーズ**
   - `disconnect` または `terminate`
   - リソースのクリーンアップ

## 次のステップ

- [メッセージフォーマット](./message-format.md) - 詳細なメッセージ構造
- [リクエスト一覧](./requests.md) - 利用可能なリクエストの詳細
- [イベント一覧](./events.md) - 発生するイベントの詳細
- [MCP実装ガイド](./mcp-implementation.md) - MCPツールとしての実装方法